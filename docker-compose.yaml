# Local development with production database
# Usage: docker compose up --build
#
# Make sure your backend/.env has production DB credentials:
#   DATABASE_HOST=your-db-cluster.db.ondigitalocean.com
#   DATABASE_PORT=25060
#   DATABASE_USER=doadmin
#   DATABASE_PASSWORD=your_password
#   DATABASE_DBNAME=run_goals
#   DATABASE_SSLMODE=require
#   DISABLE_SYNC_JOB=true
#   (plus STRAVA_CLIENT_ID, STRAVA_CLIENT_SECRET, JWT_SECRET)

version: "3.8"

services:
  backend:
    image: run-goals/backend:latest
    container_name: run-goals-backend
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    env_file:
      - ./backend/.env

  frontend:
    container_name: run-goals-frontend
    build:
      context: ./frontend/strava-goal
      dockerfile: Dockerfile
      target: dev
    volumes:
      - ./frontend/strava-goal:/app
      - /app/node_modules
    ports:
      - "4200:4200"
    environment:
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      - backend
    command: npm run start
