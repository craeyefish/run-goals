<div class="challenge-list-container">
  <!-- Header -->
  <div class="header">
    <h1>Challenges</h1>
    <div class="header-actions">
      <button class="join-code-btn" (click)="openJoinByCodeForm()">
        <span class="icon">üîë</span>
        Join by Code
      </button>
      <button class="create-btn" (click)="openCreateForm()">
        <span class="icon">+</span>
        Create Challenge
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab() === 'joined'"
      (click)="setTab('joined')">
      My Challenges
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'created'"
      (click)="setTab('created')">
      My Created
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'discover'"
      (click)="setTab('discover')">
      Discover
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="isLoading()">
    Loading challenges...
  </div>

  <!-- My Challenges Tab (Joined) -->
  <ng-container *ngIf="activeTab() === 'joined' && !isLoading()">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="joinedChallenges.length === 0">
      <div class="empty-content">
        <h2>No challenges joined yet!</h2>
        <p>Join a challenge using a code or browse the Discover tab.</p>
        <div class="empty-actions">
          <button class="primary-btn" (click)="openJoinByCodeForm()">Join by Code</button>
          <button class="secondary-btn" (click)="setTab('discover')">Discover Challenges</button>
        </div>
      </div>
    </div>

    <!-- Joined Challenges Grid -->
    <div class="section" *ngIf="joinedChallenges.length > 0">
      <div class="challenge-grid">
        <challenge-card
          *ngFor="let challenge of joinedChallenges"
          [challenge]="challenge"
          (click)="onChallengeClick(challenge)">
        </challenge-card>
      </div>
    </div>
  </ng-container>

  <!-- My Created Tab -->
  <ng-container *ngIf="activeTab() === 'created' && !isLoading()">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="createdChallenges.length === 0">
      <div class="empty-content">
        <h2>No challenges created yet!</h2>
        <p>Create your first challenge and invite others to join.</p>
        <button class="primary-btn" (click)="openCreateForm()">Create Your First Challenge</button>
      </div>
    </div>

    <!-- Created Challenges Grid -->
    <div class="section" *ngIf="createdChallenges.length > 0">
      <div class="challenge-grid">
        <challenge-card
          *ngFor="let challenge of createdChallenges"
          [challenge]="challenge"
          [showManageOptions]="true"
          (click)="onChallengeClick(challenge)">
        </challenge-card>
      </div>
    </div>
  </ng-container>

  <!-- Discover Tab -->
  <ng-container *ngIf="activeTab() === 'discover' && !isLoading()">
    <!-- Featured Section -->
    <div class="section" *ngIf="featuredChallenges().length > 0">
      <h2 class="section-title">‚≠ê Featured Challenges</h2>
      <div class="challenge-grid">
        <challenge-card
          *ngFor="let challenge of featuredChallenges()"
          [challenge]="challenge"
          [showJoinButton]="true"
          (click)="onChallengeClick(challenge)">
        </challenge-card>
      </div>
    </div>

    <!-- Public Challenges -->
    <div class="section">
      <h2 class="section-title">Public Challenges</h2>
      <div class="challenge-grid" *ngIf="challengeService.publicChallenges().length > 0">
        <challenge-card
          *ngFor="let challenge of challengeService.publicChallenges()"
          [challenge]="challenge"
          [showJoinButton]="true"
          (click)="onChallengeClick(challenge)">
        </challenge-card>
      </div>
      <div class="empty-discover" *ngIf="challengeService.publicChallenges().length === 0">
        <p>No public challenges available yet.</p>
      </div>
    </div>
  </ng-container>
</div>

<!-- Create Challenge Modal -->
<challenge-create-form
  *ngIf="showCreateForm()"
  (onSubmit)="onChallengeCreated($event)"
  (onCancel)="closeCreateForm()">
</challenge-create-form>

<!-- Join by Code Modal -->
<div class="modal-overlay" *ngIf="showJoinByCodeForm()" (click)="closeJoinByCodeForm()">
  <div class="modal-content join-code-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Join Challenge by Code</h2>
      <button class="close-btn" (click)="closeJoinByCodeForm()">√ó</button>
    </div>
    <div class="modal-body">
      <p class="help-text">Enter the 6-character challenge code to join</p>
      <div class="join-code-input-group">
        <input
          type="text"
          class="join-code-input"
          [(ngModel)]="joinCodeInput"
          [value]="joinCodeInput()"
          (ngModelChange)="joinCodeInput.set($event.toUpperCase())"
          placeholder="ABC123"
          maxlength="6"
          autofocus
        />
        <button class="join-btn" (click)="joinByCode()" [disabled]="!joinCodeInput()">
          Join
        </button>
      </div>
      <div class="error-message" *ngIf="joinCodeError()">
        {{ joinCodeError() }}
      </div>
      <div class="modal-footer-text">
        <p>Ask the challenge creator for the join code</p>
      </div>
    </div>
  </div>
</div>
