<div class="group-details-outer-container">
  <!-- Group Challenges Section -->
  <div class="challenges-outer-container">
    <div class="challenges-header-container">
      <div class="button-container">
        <div class="text-container">
          <span>üèÜ Group Challenges</span>
        </div>
      </div>
      <div class="button-container">
        <div class="text-container">
          <span>add challenge to group</span>
        </div>
        <button class="add-goal-button" (click)="openAdoptChallengeModal()">
          +
        </button>
      </div>
    </div>

    <app-data-table
      *ngIf="groupChallenges().length > 0"
      [columns]="challengeColumns"
      [data]="groupChallenges()"
      [config]="{ rowClickable: true, emptyMessage: 'No challenges in this group yet.' }"
      (rowClick)="navigateToChallenge($event.id)"
    ></app-data-table>

    <div class="empty-challenges" *ngIf="groupChallenges().length === 0">
      <p>No challenges adopted yet.</p>
      <button class="adopt-btn" (click)="openAdoptChallengeModal()">
        Add Challenge to Group
      </button>
    </div>
  </div>

  <!-- Members Section -->
  <div class="members-outer-container">
    <div class="members-header-container">
      <span>üìä Members ({{ currentYear }} Stats)</span>
    </div>
    <app-data-table
      *ngIf="memberStats().length > 0"
      [columns]="memberColumns"
      [data]="memberStats()"
      [config]="{ emptyMessage: 'No member stats available.' }"
    ></app-data-table>

    <div class="empty-state" *ngIf="memberStats().length === 0">
      <p>No member activity data for this year.</p>
    </div>
  </div>
</div>

<!-- Adopt Challenge Modal -->
<div *ngIf="showAdoptChallengeModal()" class="modal-overlay" (click)="closeAdoptChallengeModal()">
  <div class="modal-content adopt-challenge-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add Challenge to Group</h3>
      <button class="close-btn" (click)="closeAdoptChallengeModal()">√ó</button>
    </div>

    <div class="modal-body">
      <p class="modal-description">
        Adding a challenge to your group makes it visible to all members. Members can then choose to join the challenge.
      </p>

      <div class="search-box">
        <input
          type="text"
          placeholder="Search challenges..."
          [(ngModel)]="challengeSearchQuery"
          (input)="filterAvailableChallenges()"
        />
      </div>

      <div class="challenges-list-modal" *ngIf="!loadingChallenges()">
        <div
          *ngFor="let challenge of filteredAvailableChallenges()"
          class="challenge-option"
          [class.already-adopted]="isChallengeAdopted(challenge.id)"
          (click)="adoptChallenge(challenge)"
        >
          <div class="challenge-option-info">
            <div class="challenge-option-name">{{ challenge.name }}</div>
            <div class="challenge-option-meta">
              <span *ngIf="challenge.region">{{ challenge.region }}</span>
              <span *ngIf="challenge.difficulty">‚Ä¢ {{ challenge.difficulty }}</span>
            </div>
          </div>
          <span *ngIf="isChallengeAdopted(challenge.id)" class="adopted-badge">Already added</span>
          <span *ngIf="!isChallengeAdopted(challenge.id)" class="adopt-icon">+</span>
        </div>

        <div *ngIf="filteredAvailableChallenges().length === 0" class="no-challenges">
          <p>No challenges found matching your search.</p>
        </div>
      </div>

      <div *ngIf="loadingChallenges()" class="loading">
        Loading challenges...
      </div>
    </div>
  </div>
</div>
