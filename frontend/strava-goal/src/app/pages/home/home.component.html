<div class="home-container">
  <!-- Retro Stats Banner -->
  <div class="stats-banner">
    <div class="year-selector">
      <button
        *ngFor="let year of availableYears"
        class="year-pill"
        [class.active]="year === selectedYear"
        (click)="selectYear(year)"
      >
        {{ year }}
      </button>
    </div>
    <div class="banner-stats">
      <div class="banner-stat">
        <span class="stat-value">{{ totalDistance | number:'1.0-0' }}</span>
        <span class="stat-label">km</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalElevation | number:'1.0-0' }}</span>
        <span class="stat-label">m â†‘</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalSummits }}</span>
        <span class="stat-label">summits</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalActivities }}</span>
        <span class="stat-label">runs</span>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading dashboard...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">
    <!-- Yearly Goals Section -->
    <app-yearly-goals
      [currentDistance]="totalDistance"
      [currentElevation]="totalElevation"
      [currentSummits]="totalSummits"
      [yearActivities]="yearActivities"
      [recentSummits]="recentSummits"
      [selectedYear]="selectedYear"
      (openPeakPicker)="openSummitPicker()"
    ></app-yearly-goals>

    <!-- Summit Wishlist (permanent, year-independent) -->
    <div class="summit-wishlist-section" [class.collapsed]="wishlistCollapsed">
      <div class="summit-header" (click)="toggleWishlist()">
        <div class="header-left">
          <span class="collapse-icon">{{ wishlistCollapsed ? 'â–¶' : 'â–¼' }}</span>
          <h3>ğŸ“‹ Summit Wishlist</h3>
          <div class="summit-progress">
            <span>{{ completedFavourites.length }}/{{ favouritePeaks.length }} completed</span>
          </div>
        </div>
        <div class="header-actions" (click)="$event.stopPropagation()">
          <button class="add-summit-btn" (click)="viewWishlistOnMap()">
            ğŸ—ºï¸ View on Map
          </button>
          <button class="add-summit-btn" (click)="openSummitPicker()">
            Â± Edit Peaks
          </button>
        </div>
      </div>

      <!-- Collapsible Content -->
      <div class="wishlist-content" *ngIf="!wishlistCollapsed">
        <!-- Tabs for Complete/Incomplete -->
        <div class="wishlist-tabs">
          <button
            class="tab"
            [class.active]="wishlistTab === 'incomplete'"
            (click)="wishlistTab = 'incomplete'"
          >
            To Do ({{ incompleteFavourites.length }})
          </button>
          <button
            class="tab"
            [class.active]="wishlistTab === 'complete'"
            (click)="wishlistTab = 'complete'"
          >
            Complete ({{ completedFavourites.length }})
          </button>
        </div>

        <!-- Incomplete Peaks -->
        <div class="summit-list" *ngIf="wishlistTab === 'incomplete'">
          <div
            class="summit-item"
            *ngFor="let summit of incompleteFavourites"
          >
            <div class="summit-info">
              <span class="summit-name">{{ summit.name }}</span>
              <span class="summit-elevation">{{ summit.elevation }}m</span>
            </div>
            <div class="summit-actions">
              <span class="summit-status">Pending</span>
              <button class="remove-btn" (click)="removeFavourite(summit.id)" title="Remove">Ã—</button>
            </div>
          </div>
          <div class="empty-state" *ngIf="incompleteFavourites.length === 0">
            <p *ngIf="favouritePeaks.length > 0">All favourites completed! ğŸ‰</p>
            <p *ngIf="favouritePeaks.length === 0">Add your first peak target to get started! ğŸ”ï¸</p>
          </div>
        </div>

        <!-- Completed Peaks -->
        <div class="summit-list" *ngIf="wishlistTab === 'complete'">
          <div
            class="summit-item completed"
            *ngFor="let summit of completedFavourites"
          >
            <div class="summit-info">
              <span class="summit-name">{{ summit.name }}</span>
              <span class="summit-date" *ngIf="summit.summitedAt">
                Summited {{ summit.summitedAt | date:'MMM d, yyyy' }}
              </span>
            </div>
            <div class="summit-actions">
              <span class="summit-status">âœ“ Done</span>
              <button class="remove-btn" (click)="removeFavourite(summit.id)" title="Remove">Ã—</button>
            </div>
          </div>
          <div class="empty-state" *ngIf="completedFavourites.length === 0">
            <p>No completed favourites yet. Keep climbing! ğŸ”ï¸</p>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>

<!-- Peak Picker Modal - OUTSIDE home-container -->
<div *ngIf="showSummitPicker"
     class="modal-overlay peak-picker-modal"
     (mousedown)="onSummitOverlayMouseDown($event)">
  <div class="modal-content modal-content-large"
       (mousedown)="$event.stopPropagation()">
    <app-peak-picker
      [initialSelectedIds]="favouriteIds"
      (peakAdded)="onPeakAdded($event)"
      (peakRemoved)="onPeakRemoved($event)"
      (close)="closeSummitPicker()"
    ></app-peak-picker>
  </div>
</div>
