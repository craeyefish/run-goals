<div class="home-container">
  <!-- Retro Stats Banner -->
  <div class="stats-banner">
    <div class="year-badge">{{ currentYear }}</div>
    <div class="banner-stats">
      <div class="banner-stat">
        <span class="stat-value">{{ totalDistance | number:'1.0-0' }}</span>
        <span class="stat-label">km</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalElevation | number:'1.0-0' }}</span>
        <span class="stat-label">m â†‘</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalSummits }}</span>
        <span class="stat-label">summits</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalActivities }}</span>
        <span class="stat-label">runs</span>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading dashboard...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">
    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Distance Progress Chart -->
      <div class="chart-section">
        <div class="chart-header">
          <h3>ğŸ“ˆ Distance Progress</h3>
          <div class="chart-goal">
            <span>Goal: {{ distanceGoal | number }} km</span>
            <button class="edit-goal-btn" (click)="openGoalEditor('distance')">Edit</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas #distanceChart></canvas>
        </div>
      </div>

      <!-- Elevation Progress Chart -->
      <div class="chart-section">
        <div class="chart-header">
          <h3>â›°ï¸ Elevation Progress</h3>
          <div class="chart-goal">
            <span>Goal: {{ elevationGoal | number }} m</span>
            <button class="edit-goal-btn" (click)="openGoalEditor('elevation')">Edit</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas #elevationChart></canvas>
        </div>
      </div>
    </div>

    <!-- Summit Goals -->
    <div class="summit-goals">
      <div class="summit-header">
        <h3>
          ğŸ”ï¸ Summit Wishlist
        </h3>
        <div class="summit-progress">
          <div class="progress-ring">
            <svg viewBox="0 0 36 36">
              <circle class="progress-bg" cx="18" cy="18" r="16"/>
              <circle 
                class="progress-value" 
                cx="18" cy="18" r="16"
                [attr.stroke-dasharray]="100"
                [attr.stroke-dashoffset]="100 - summitProgressPercentage"
              />
            </svg>
          </div>
          <span>{{ completedTargetSummits }}/{{ targetSummits.length || summitGoal }}</span>
        </div>
        <button class="add-summit-btn" (click)="openSummitPicker()">
          {{ targetSummits.length > 0 ? 'Â± Edit Peaks' : '+ Add Peak' }}
        </button>
      </div>

      <div class="summit-list" *ngIf="targetSummits.length > 0">
        <div 
          class="summit-item" 
          *ngFor="let summit of targetSummits"
          [class.completed]="summit.completed"
        >
          <div class="summit-info">
            <span class="summit-name">{{ summit.name }}</span>
            <span class="summit-date" *ngIf="summit.completed && summit.summitedAt">
              Summited {{ summit.summitedAt | date:'MMM d, yyyy' }}
            </span>
          </div>
          <div class="summit-actions">
            <span class="summit-status">{{ summit.completed ? 'âœ“ Done' : 'Pending' }}</span>
            <button class="remove-btn" (click)="removeTargetSummit(summit.id)" title="Remove">Ã—</button>
          </div>
        </div>
      </div>

      <div class="no-summits" *ngIf="targetSummits.length === 0">
        <p>No peaks on your wishlist yet. Add peaks you want to summit this year!</p>
      </div>
    </div>
  </ng-container>
</div>

<!-- Goal Editor Modal - OUTSIDE home-container -->
<div *ngIf="showGoalEditor" 
     class="modal-overlay"
     (mousedown)="onOverlayMouseDown($event)">
  <div class="modal-content"
       (mousedown)="$event.stopPropagation()">
    <h4>Edit {{ editingGoalType === 'distance' ? 'Distance' : 'Elevation' }} Goal</h4>
    <div class="form-group">
      <label>
        Target {{ editingGoalType === 'distance' ? '(km)' : '(meters)' }}
      </label>
      <input 
        type="number" 
        [(ngModel)]="editingGoalValue"
      />
    </div>
    <div class="modal-buttons">
      <button class="modal-btn" (click)="showGoalEditor = false">Cancel</button>
      <button class="modal-btn" (click)="saveGoal()">Save</button>
    </div>
  </div>
</div>

<!-- Peak Picker Modal - OUTSIDE home-container -->
<div *ngIf="showSummitPicker"
     class="modal-overlay peak-picker-modal"
     (mousedown)="onSummitOverlayMouseDown($event)">
  <div class="modal-content modal-content-large"
       (mousedown)="$event.stopPropagation()">
    <app-peak-picker
      [initialSelectedIds]="personalGoals?.target_summits || []"
      (peakAdded)="onPeakAdded($event)"
      (peakRemoved)="onPeakRemoved($event)"
      (close)="closeSummitPicker()"
    ></app-peak-picker>
  </div>
</div>
