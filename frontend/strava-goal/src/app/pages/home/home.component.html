<div class="home-container">
  <!-- Retro Stats Banner -->
  <div class="stats-banner">
    <div class="year-badge">{{ currentYear }}</div>
    <div class="banner-stats">
      <div class="banner-stat">
        <span class="stat-value">{{ totalDistance | number:'1.0-0' }}</span>
        <span class="stat-label">km</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalElevation | number:'1.0-0' }}</span>
        <span class="stat-label">m â†‘</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalSummits }}</span>
        <span class="stat-label">summits</span>
      </div>
      <div class="banner-stat">
        <span class="stat-value">{{ totalActivities }}</span>
        <span class="stat-label">runs</span>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading dashboard...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">
    <!-- Yearly Goals Section -->
    <app-yearly-goals
      [currentDistance]="totalDistance"
      [currentElevation]="totalElevation"
      [currentSummits]="totalSummits"
      [yearActivities]="yearActivities"
      [recentSummits]="recentSummits"
      (openPeakPicker)="openSummitPicker()"
    ></app-yearly-goals>

    <!-- Summit Wishlist (kept separate for detailed peak list) -->
    <div class="summit-goals" *ngIf="targetSummits.length > 0">
      <div class="summit-header">
        <h3>ğŸ“‹ Peak Wishlist</h3>
        <div class="summit-progress">
          <span>{{ completedTargetSummits }}/{{ targetSummits.length }} completed</span>
        </div>
        <button class="add-summit-btn" (click)="openSummitPicker()">
          Â± Edit Peaks
        </button>
      </div>

      <div class="summit-list">
        <div 
          class="summit-item" 
          *ngFor="let summit of targetSummits"
          [class.completed]="summit.completed"
        >
          <div class="summit-info">
            <span class="summit-name">{{ summit.name }}</span>
            <span class="summit-date" *ngIf="summit.completed && summit.summitedAt">
              Summited {{ summit.summitedAt | date:'MMM d, yyyy' }}
            </span>
          </div>
          <div class="summit-actions">
            <span class="summit-status">{{ summit.completed ? 'âœ“ Done' : 'Pending' }}</span>
            <button class="remove-btn" (click)="removeTargetSummit(summit.id)" title="Remove">Ã—</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Active Challenges Section -->
    <div class="active-challenges-section">
      <div class="section-header">
        <h3>ğŸ† Active Challenges</h3>
        <button class="view-all-btn" (click)="navigateToChallenges()">
          View All Challenges â†’
        </button>
      </div>

      <div class="challenges-grid" *ngIf="activeChallenges.length > 0">
        <div 
          *ngFor="let challenge of activeChallenges" 
          class="challenge-wrapper"
          (click)="navigateToChallenge(challenge.id)"
        >
          <challenge-card [challenge]="challenge"></challenge-card>
        </div>
      </div>

      <div class="no-challenges" *ngIf="activeChallenges.length === 0">
        <p>You haven't joined any challenges yet.</p>
        <button class="primary-btn" (click)="navigateToChallenges()">
          Discover Challenges
        </button>
      </div>
    </div>
  </ng-container>
</div>

<!-- Peak Picker Modal - OUTSIDE home-container -->
<div *ngIf="showSummitPicker"
     class="modal-overlay peak-picker-modal"
     (mousedown)="onSummitOverlayMouseDown($event)">
  <div class="modal-content modal-content-large"
       (mousedown)="$event.stopPropagation()">
    <app-peak-picker
      [initialSelectedIds]="personalGoals?.target_summits || []"
      (peakAdded)="onPeakAdded($event)"
      (peakRemoved)="onPeakRemoved($event)"
      (close)="closeSummitPicker()"
    ></app-peak-picker>
  </div>
</div>
