<div class="challenge-card" [class.completed]="progressChallenge?.isCompleted" [class.locked]="challenge.isLocked">
  <!-- Header -->
  <div class="card-header">
    <div class="badges-left">
      <div class="type-badge" [class]="challenge.challengeType">
        {{ challengeService.getChallengeTypeLabel(challenge.challengeType) }}
      </div>
      <div class="goal-type-badge">
        {{ challengeService.getGoalTypeIcon(challenge.goalType) }}
        {{ challengeService.getGoalTypeLabel(challenge.goalType) }}
      </div>
    </div>
    <div class="badges-right">
      <div class="visibility-badge" *ngIf="challenge.visibility !== 'private'">
        {{ challenge.visibility === 'public' ? 'ğŸŒ' : 'ğŸ‘¥' }}
      </div>
      <div class="locked-badge" *ngIf="challenge.isLocked">
        ğŸ”’
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="card-content">
    <h3 class="challenge-name">{{ challenge.name }}</h3>
    
    <p class="challenge-description" *ngIf="challenge.description">
      {{ challenge.description | slice:0:100 }}{{ (challenge.description!.length) > 100 ? '...' : '' }}
    </p>

    <!-- Target info -->
    <div class="target-row" *ngIf="challengeService.formatTargetValue(challenge)">
      <span class="target-value">
        ğŸ¯ {{ challengeService.formatTargetValue(challenge) }}
      </span>
    </div>

    <!-- Meta info -->
    <div class="meta-row">
      <span class="region" *ngIf="challenge.region">
        ğŸ“ {{ challenge.region }}
      </span>
      <span class="difficulty" *ngIf="challenge.difficulty"
        [style.color]="challengeService.getDifficultyColor(challenge.difficulty)">
        {{ challenge.difficulty }}
      </span>
    </div>

    <!-- Progress (only for ChallengeWithProgress) -->
    <div class="progress-section" *ngIf="progressChallenge">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      </div>
      <div class="progress-text">
        <span>
          <ng-container *ngIf="challenge.goalType === 'specific_summits'">
            {{ progressChallenge.completedPeaks }}/{{ progressChallenge.totalPeaks }} peaks
          </ng-container>
          <ng-container *ngIf="challenge.goalType === 'distance'">
            {{ (progressChallenge.currentDistance / 1000) | number:'1.0-0' }}/{{ (challenge.targetValue! / 1000) | number:'1.0-0' }} km
          </ng-container>
          <ng-container *ngIf="challenge.goalType === 'elevation'">
            {{ progressChallenge.currentElevation | number }}/{{ challenge.targetValue! | number }} m
          </ng-container>
          <ng-container *ngIf="challenge.goalType === 'summit_count'">
            {{ progressChallenge.currentSummitCount }}/{{ challenge.targetSummitCount! }} summits
          </ng-container>
        </span>
        <span class="percentage">{{ progressPercentage }}%</span>
      </div>
    </div>

    <!-- Deadline -->
    <div class="deadline-row" *ngIf="hasDeadline">
      <span class="deadline" [class.overdue]="isOverdue" [class.soon]="daysRemaining !== null && daysRemaining <= 7 && daysRemaining >= 0">
        <ng-container *ngIf="isOverdue">
          âš ï¸ Overdue by {{ -daysRemaining! }} days
        </ng-container>
        <ng-container *ngIf="!isOverdue && daysRemaining !== null">
          ğŸ“… {{ daysRemaining }} days remaining
        </ng-container>
      </span>
    </div>
  </div>

  <!-- Footer -->
  <div class="card-footer">
    <div class="mode-badge" [class]="challenge.competitionMode">
      {{ challenge.competitionMode === 'collaborative' ? 'ğŸ¤ Collaborative' : 'ğŸ† Competitive' }}
    </div>

    <button class="join-btn" *ngIf="showJoinButton && !isJoined" (click)="onJoinClick($event)">
      Join
    </button>

    <div class="completed-badge" *ngIf="progressChallenge?.isCompleted">
      âœ… Completed
    </div>
  </div>

  <!-- Manage Options (for created challenges) -->
  <div class="manage-section" *ngIf="showManageOptions">
    <div class="join-code-section">
      <label class="join-code-label">Join Code:</label>
      <div class="join-code-display">
        <span class="join-code-value">{{ challenge.joinCode }}</span>
        <button class="copy-btn" (click)="copyJoinCode($event)" title="Copy join code">
          ğŸ“‹
        </button>
      </div>
    </div>
  </div>
</div>
